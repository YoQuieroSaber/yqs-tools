#Evitar visitas al sitio sin www
#Reemplazar dominio.org por su dominio

server {
	listen 80;
	server_name dominio.org;
        if ( $query_string ) {
                #Redirects pages with query strings.
                return 301 http://www.dominio.org$request_uri?$query_string;
        }
	return 301 http://www.dominio.org$request_uri;
}

server {
	listen 80 default_server;
	listen [::]:80 default_server;

	# SSL configuration
	#
	# listen 443 ssl default_server;
	# listen [::]:443 ssl default_server;
	#
	# Self signed certs generated by the ssl-cert package
	# Don't use them in a production server!
	#
	# include snippets/snakeoil.conf;

	root /var/www/html;

	# Add index.php to the list if you are using PHP
	index index.html index.htm index.nginx-debian.html;

	server_name www.dominio.org;

        # esto activa la zona de cache en el server de este dominio, el cache dura un minuto y se reescribe, las respuestas se cachean al primer intento
        proxy_cache yqs_cache_2015;
        proxy_cache_valid any 1m;
        proxy_cache_min_uses 1;
        # esto evita que se abran cientos o miles de requests a la webapp cada 1 minuto cuando expira el cache, le da 30 segundos para generar la respuesta y encola todo lo dem√°s esperando el primer request
        proxy_cache_lock on;
        proxy_cache_lock_timeout 30s;

        location /static/  {
		alias /full/path/to/votainteligente-portal-electoral/static/;
	}
        location /cache/  {
                alias /ful//path/to/votainteligente-portal-electoral/cache/;
        }

        location / {
	    proxy_pass         http://localhost:3279/;
            proxy_set_header   Host $host;
            proxy_set_header   X-Real-IP $remote_addr;
            proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header   X-Forwarded-Host $server_name;
            proxy_cache_key "$host$request_uri$cookie_sessionid$http_accept_language";
        }
}


